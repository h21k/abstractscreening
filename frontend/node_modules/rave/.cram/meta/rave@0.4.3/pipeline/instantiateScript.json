{"absId":"rave@0.4.3/pipeline/instantiateScript","pluginId":"curl/loader/cjsm11","resourceId":"rave@0.4.3/pipeline/instantiateScript","loader":true,"source":"define('rave@0.4.3/pipeline/instantiateScript',['require','exports','module'],function(require,exports,module,define){/** @license MIT License (c) copyright 2014 original authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\nmodule.exports = instantiateScript;\n\nvar metadata = require('../lib/metadata');\nvar path = require('../lib/path');\n\nfunction instantiateScript (scriptFactory) {\n\treturn function (load) {\n\t\tvar packages, pkg, deps;\n\n\t\t// find dependencies\n\t\tpackages = load.metadata.rave.packages;\n\t\tpkg = metadata.findPackage(packages, load.name);\n\t\tif (pkg && pkg.deps) {\n\t\t\tdeps = pkgMains(packages, pkg.deps)\n\t\t}\n\n\t\tvar factory = scriptFactory(this, load);\n\t\treturn {\n\t\t\tdeps: deps,\n\t\t\texecute: function () {\n\t\t\t\tfactory();\n\t\t\t\treturn new Module({});\n\t\t\t}\n\t\t};\n\t}\n}\n\n\nfunction pkgMains (packages, depPkgs) {\n\tvar main, mains = [];\n\tfor (var name in depPkgs) {\n\t\t// package-to-package dependency\n\t\tmain = packages[depPkgs[name]].name;\n\t\tif (main) {\n\t\t\tmains.push(main);\n\t\t}\n\t}\n\treturn mains;\n}\n\n});\n\n","modules":[{"pos":0,"count":117,"id":"rave@0.4.3/pipeline/instantiateScript","depList":["require","exports","module"],"factory":true,"argList":["require","exports","module","define"],"requires":[{"id":"rave@0.4.3/lib/metadata","pos":289,"count":26},{"id":"rave@0.4.3/lib/path","pos":328,"count":22}]}],"compileTime":"2014-11-17T20:58:47.365Z"}