{"absId":"rave@0.4.3/src/hooks","pluginId":"curl/loader/cjsm11","resourceId":"rave@0.4.3/src/hooks","loader":true,"source":"define('rave@0.4.3/src/hooks',['require','exports','module'],function(require,exports,module,define){/** @license MIT License (c) copyright 2014 original authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\nvar normalizeCjs = require('../pipeline/normalizeCjs');\nvar locateAsIs = require('../pipeline/locateAsIs');\nvar fetchAsText = require('../pipeline/fetchAsText');\nvar translateAsIs = require('../pipeline/translateAsIs');\nvar instantiateNode = require('../pipeline/instantiateNode');\nvar nodeFactory = require('../lib/debug/nodeFactory');\nvar nodeEval = require('../lib/debug/nodeEval');\nvar instantiateJson = require('../pipeline/instantiateJson');\nvar path = require('../lib/path');\nvar beget = require('../lib/beget');\nvar override = require('../load/override');\n\nmodule.exports = baseHooks;\n\nfunction baseHooks (context) {\n\tvar nativeHooks, resetOverride, raveOverride, jsonOverride, overrides,\n\t\tnewHooks;\n\n\tnativeHooks = getLoaderHooks(context.loader);\n\tcontext.load = { nativeHooks: nativeHooks };\n\n\tcontext = beget(context);\n\n\t// we need this until Loader spec and shim stabilize\n\tresetOverride = {\n\t\thooks: {\n\t\t\tnormalize: normalizeCjs,\n\t\t\tfetch: fetchAsText,\n\t\t\ttranslate: translateAsIs\n\t\t}\n\t};\n\n\t// load things in rave package\n\traveOverride = {\n\t\tpackage: 'rave',\n\t\thooks: {\n\t\t\tlocate: locateRaveWithContext(context),\n\t\t\tinstantiate: instantiateNode(nodeFactory(nodeEval))\n\t\t}\n\t};\n\n\t// load json metadata files\n\tjsonOverride = {\n\t\textensions: [ '.json' ],\n\t\thooks: {\n\t\t\tlocate: withContext(context, locateAsIs),\n\t\t\tinstantiate: instantiateJson\n\t\t}\n\t};\n\n\toverrides = [resetOverride, raveOverride, jsonOverride];\n\tnewHooks = override.hooks(nativeHooks, overrides);\n\tsetLoaderHooks(context.loader, newHooks);\n\n\treturn context;\n}\n\nfunction getLoaderHooks (loader) {\n\treturn {\n\t\tnormalize: loader.normalize,\n\t\tlocate: loader.locate,\n\t\tfetch: loader.fetch,\n\t\ttranslate: loader.translate,\n\t\tinstantiate: loader.instantiate\n\t};\n}\n\nfunction setLoaderHooks (loader, hooks) {\n\tfor (var p in hooks) loader[p] = hooks[p];\n\treturn loader;\n}\n\nfunction withContext (context, func) {\n\treturn function (load) {\n\t\tload.metadata.rave = context;\n\t\treturn func.call(this, load);\n\t};\n}\n\nfunction locateRaveWithContext (context) {\n\tvar parts = context.raveScript.split('/');\n\tparts.pop(); // script file\n\tparts.pop(); // script directory\n\tvar base = parts.join('/');\n\treturn function (load) {\n\t\tload.metadata.rave = context;\n\t\treturn path.joinPaths(base, path.ensureExt(load.name, '.js'));\n\t};\n}\n\n});\n\n","modules":[{"pos":0,"count":100,"id":"rave@0.4.3/src/hooks","depList":["require","exports","module"],"factory":true,"argList":["require","exports","module","define"],"requires":[{"id":"rave@0.4.3/pipeline/normalizeCjs","pos":239,"count":35},{"id":"rave@0.4.3/pipeline/locateAsIs","pos":293,"count":33},{"id":"rave@0.4.3/pipeline/fetchAsText","pos":346,"count":34},{"id":"rave@0.4.3/pipeline/translateAsIs","pos":402,"count":36},{"id":"rave@0.4.3/pipeline/instantiateNode","pos":462,"count":38},{"id":"rave@0.4.3/lib/debug/nodeFactory","pos":520,"count":35},{"id":"rave@0.4.3/lib/debug/nodeEval","pos":572,"count":32},{"id":"rave@0.4.3/pipeline/instantiateJson","pos":628,"count":38},{"id":"rave@0.4.3/lib/path","pos":679,"count":22},{"id":"rave@0.4.3/lib/beget","pos":715,"count":23},{"id":"rave@0.4.3/load/override","pos":755,"count":27}]}],"compileTime":"2014-11-17T20:58:47.227Z"}